## 🧮 为什么埃拉托色尼筛法的时间复杂度是 O(n log log n)

------

### 1️⃣ 代码回顾

```
for (int i = 2; i <= n; i++)
    if (IsPrime[i]) {
        prime[tot++] = i;
        for (int j = i * 2; j <= n; j += i)
            IsPrime[j] = false;
    }
```

外层循环枚举 `2 ~ n`，当 `i` 是质数时，内层循环把所有 `i` 的倍数标记掉。

------

### 2️⃣ 时间复杂度拆解

关键在内层循环的执行次数：

- 当 `i = 2` 时，标记了大约 `n / 2` 个数
- 当 `i = 3` 时，标记了大约 `n / 3` 个数
- 当 `i = 5` 时，标记了大约 `n / 5` 个数
- ……

也就是说，每个质数 `p` 会标记大约 `n / p` 个数。
 所以总的标记次数是：

![image-20251012105147421](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105147421.png)

### 3️⃣ 化简

把 `n` 提出来：

![image-20251012105203162](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105203162.png)

已知一个重要结论：
 质数倒数的和近似为对数的对数（即 log 的 log）：

![image-20251012105213443](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105213443.png)

------

### 4️⃣ 得出复杂度

代入上式：

![image-20251012105223421](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105223421.png)

因此时间复杂度是：

![image-20251012105229964](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105229964.png)

------

### 5️⃣ 为什么是 log log n，而不是 log n？

- 所有整数的倒数和：

  ![image-20251012105239539](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105239539.png)

  （增长速度比较快）

- 但质数更稀疏，它们的倒数和只增长到：

  ![image-20251012105250698](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105250698.png)

也就是说，只取质数使增长速度变慢，于是出现了 **log log n** 这个“双对数”因子。

------

✅ **总结：**

> 埃拉托色尼筛法（Eratosthenes Sieve）的复杂度是
>
> ![image-20251012105302058](C:\Users\admin\Desktop\my_notes\a_notes\算法题\5.质数筛法\1.为什么埃氏筛法的复杂度是nloglogn\1.为什么埃氏筛法的复杂度是nloglogn.assets\image-20251012105302058.png)
>
> 因为它对每个质数的倍数进行标记，而质数倒数的和是 ln ln n 级别的。